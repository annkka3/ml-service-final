{% extends "base.html" %}
{% block content %}
<h2>–ö–∞–±–∏–Ω–µ—Ç</h2>

<section class="grid-2">
  <div class="card">
    <h3>–ë–∞–ª–∞–Ω—Å</h3>
    <p class="big">{{ balance }}</p>
    <form method="post" action="/web/topup" class="row">
      <input type="number" step="1" min="1" name="amount" placeholder="–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è" required>
      <button type="submit">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
    </form>
  </div>

  <div class="card">
    <h3>–ü–µ—Ä–µ–≤–æ–¥</h3>
    <form method="post" action="/web/translate">
      <label>–¢–µ–∫—Å—Ç
        <textarea name="text" rows="4" required></textarea>
      </label>
      <label>–Ø–∑—ã–∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
        <input name="target_lang" value="en" />
      </label>
      <button type="submit">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
    </form>
    {% if result %}
      <div class="result">
        <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç</h4>
        <pre>{{ result }}</pre>
      </div>
    {% endif %}
  </div>
</section>

<section class="card">
  <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
  {% if history and history|length %}
    <table class="table">
      <thead><tr><th>ID</th><th>–î–∞—Ç–∞</th><th>–¢–µ–∫—Å—Ç</th><th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th></tr></thead>
      <tbody>
      {% for item in history %}
        <tr>
          <td>{{ item.id or loop.index }}</td>
          <td>{{ item.created_at or item.timestamp or "" }}</td>
          <td>{{ item.text or item.source_text or "" }}</td>
          <td>{{ item.translated_text or item.result or "" }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>–ü–æ–∫–∞ –ø—É—Å—Ç–æ.</p>
  {% endif %}
</section>

<!-- üëá –≤—Å—Ç–∞–≤–ª—è–µ–º —Å—é–¥–∞ –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É -->
<section class="card">
  <h3>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
  {% if txns and txns|length > 0 %}
    <table class="table small">
      <thead><tr><th>#</th><th>–í—Ä–µ–º—è</th><th>–¢–∏–ø</th><th>–°—É–º–º–∞</th></tr></thead>
      <tbody>
      {% for t in txns[:10] %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ t.timestamp or t.created_at }}</td>
          <td>
            {% set ttype = (t.type or '') | lower %}
            {% if ttype in ['topup', '–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ'] %}–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
            {% elif ttype in ['debit', '—Å–ø–∏—Å–∞–Ω–∏–µ'] %}–°–ø–∏—Å–∞–Ω–∏–µ
            {% else %}{{ t.type }}{% endif %}
          </td>
          <td>{{ t.amount }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    <p><a href="/web/transactions">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ ‚Üí</a></p>
  {% else %}
    <p>–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π.</p>
  {% endif %}
</section>
<!-- ‚òùÔ∏è –∫–æ–Ω–µ—Ü –≤—Å—Ç–∞–≤–∫–∏ -->

{% if error %}<p class="error">{{ error }}</p>{% endif %}
{% endblock %}

